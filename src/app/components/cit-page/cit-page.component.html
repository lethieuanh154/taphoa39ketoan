<div class="cit-page">
  <!-- HEADER -->
  <div class="page-header">
    <div class="header-left">
      <h1>üè¢ Thu·∫ø Thu Nh·∫≠p Doanh Nghi·ªáp</h1>
      <p class="subtitle">TK 3334 - Thu·∫ø TNDN ph·∫£i n·ªôp | Thu·∫ø su·∫•t: 20%</p>
    </div>
    <div class="header-actions">
      <select [(ngModel)]="filterYear" (change)="onYearChange()" class="year-select">
        <option *ngFor="let y of years" [value]="y">NƒÉm {{ y }}</option>
      </select>
      <button class="btn btn-primary">+ T·∫°o t·ªù khai</button>
    </div>
  </div>

  <!-- TAX INFO -->
  <div class="tax-info">
    <div class="info-item">
      <strong>Thu·∫ø su·∫•t TNDN ph·ªï th√¥ng:</strong> 20%
    </div>
    <div class="info-item">
      <strong>DN si√™u nh·ªè (DT &lt; 3 t·ª∑):</strong> 15-17%
    </div>
    <div class="info-item">
      <strong>K·ª≥ k√™ khai:</strong> Qu√Ω / NƒÉm
    </div>
    <div class="info-item">
      <strong>H·∫°n n·ªôp:</strong> Ng√†y 30 th√°ng sau qu√Ω
    </div>
  </div>

  <!-- SUMMARY CARDS -->
  <div class="summary-cards">
    <div class="card revenue">
      <div class="card-icon">üìà</div>
      <div class="card-content">
        <span class="card-value">{{ formatCurrency(yearStats.totalRevenue) }}</span>
        <span class="card-label">T·ªïng doanh thu</span>
      </div>
    </div>
    <div class="card expenses">
      <div class="card-icon">üìâ</div>
      <div class="card-content">
        <span class="card-value">{{ formatCurrency(yearStats.totalExpenses) }}</span>
        <span class="card-label">T·ªïng chi ph√≠</span>
      </div>
    </div>
    <div class="card income">
      <div class="card-icon">üí∞</div>
      <div class="card-content">
        <span class="card-value">{{ formatCurrency(yearStats.totalTaxableIncome) }}</span>
        <span class="card-label">TN ch·ªãu thu·∫ø</span>
      </div>
    </div>
    <div class="card cit">
      <div class="card-icon">üèõÔ∏è</div>
      <div class="card-content">
        <span class="card-value">{{ formatCurrency(yearStats.totalCIT) }}</span>
        <span class="card-label">Thu·∫ø TNDN</span>
      </div>
    </div>
  </div>

  <!-- DECLARATION LIST -->
  <div class="declaration-list">
    <div class="list-header">
      <h2>T·ªù khai thu·∫ø TNDN nƒÉm {{ filterYear }}</h2>
    </div>

    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>K·ª≥</th>
            <th>S·ªë t·ªù khai</th>
            <th>Doanh thu</th>
            <th>Chi ph√≠</th>
            <th>TN ch·ªãu thu·∫ø</th>
            <th>Thu·∫ø su·∫•t</th>
            <th>Thu·∫ø TNDN</th>
            <th>H·∫°n n·ªôp</th>
            <th>Tr·∫°ng th√°i</th>
            <th>Thao t√°c</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let dec of declarations" (click)="viewDeclaration(dec)">
            <td><strong>{{ getQuarterLabel(dec.quarter) }}/{{ dec.year }}</strong></td>
            <td>{{ dec.declarationNo }}</td>
            <td class="amount">{{ formatCurrency(dec.revenue) }}</td>
            <td class="amount">{{ formatCurrency(dec.expenses) }}</td>
            <td class="amount">{{ formatCurrency(dec.taxableIncome) }}</td>
            <td class="center">{{ dec.taxRate }}%</td>
            <td class="amount highlight">{{ formatCurrency(dec.citAmount) }}</td>
            <td>{{ formatDate(dec.submissionDeadline) }}</td>
            <td>
              <span class="status-badge" [ngClass]="getStatusClass(dec.status)">
                {{ getStatusLabel(dec.status) }}
              </span>
            </td>
            <td (click)="$event.stopPropagation()">
              <button class="btn-icon" (click)="viewDeclaration(dec)">üëÅÔ∏è</button>
            </td>
          </tr>
          <tr *ngIf="declarations.length === 0">
            <td colspan="10" class="empty-row">Ch∆∞a c√≥ t·ªù khai thu·∫ø TNDN</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- DETAIL MODAL -->
  <div class="modal-overlay" *ngIf="showDetailModal" (click)="closeDetailModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ selectedDeclaration?.declarationNo }}</h2>
        <button class="btn-close" (click)="closeDetailModal()">√ó</button>
      </div>
      <div class="modal-body" *ngIf="selectedDeclaration">
        <div class="detail-grid">
          <div class="detail-item">
            <span class="label">K·ª≥ k√™ khai:</span>
            <span class="value">{{ getQuarterLabel(selectedDeclaration.quarter) }}/{{ selectedDeclaration.year }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Doanh thu:</span>
            <span class="value">{{ formatCurrency(selectedDeclaration.revenue) }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Chi ph√≠ ƒë∆∞·ª£c tr·ª´:</span>
            <span class="value">{{ formatCurrency(selectedDeclaration.expenses) }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Thu nh·∫≠p ch·ªãu thu·∫ø:</span>
            <span class="value">{{ formatCurrency(selectedDeclaration.taxableIncome) }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Thu·∫ø su·∫•t:</span>
            <span class="value">{{ selectedDeclaration.taxRate }}%</span>
          </div>
          <div class="detail-item main">
            <span class="label">Thu·∫ø TNDN ph·∫£i n·ªôp:</span>
            <span class="value">{{ formatCurrency(selectedDeclaration.citAmount) }}</span>
          </div>
        </div>

        <div class="accounting-entry">
          <h3>ƒê·ªãnh kho·∫£n</h3>
          <p>N·ª£ TK 8211 - Chi ph√≠ thu·∫ø TNDN hi·ªán h√†nh: {{ formatCurrency(selectedDeclaration.citAmount) }}</p>
          <p>C√≥ TK 3334 - Thu·∫ø TNDN: {{ formatCurrency(selectedDeclaration.citAmount) }}</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeDetailModal()">ƒê√≥ng</button>
      </div>
    </div>
  </div>
</div>
