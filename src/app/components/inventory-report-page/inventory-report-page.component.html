<div class="inventory-report-page">
  <!-- HEADER -->
  <div class="page-header">
    <div>
      <h1 class="page-title">T·ªïng h·ª£p Nh·∫≠p - Xu·∫•t - T·ªìn</h1>
      <p class="page-subtitle">B√°o c√°o t·ªïng h·ª£p t√¨nh h√¨nh nh·∫≠p xu·∫•t t·ªìn kho trong k·ª≥</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="print()">
        <span class="icon">üñ®</span> In
      </button>
      <button class="btn btn-primary" (click)="exportToExcel()">
        <span class="icon">üì•</span> Xu·∫•t Excel
      </button>
    </div>
  </div>

  <!-- SUMMARY CARDS -->
  <div class="summary-cards">
    <div class="summary-card card-products">
      <div class="card-icon">üì¶</div>
      <div class="card-content">
        <span class="card-label">S·∫£n ph·∫©m</span>
        <span class="card-value">{{ summary.totalProducts }}</span>
      </div>
    </div>
    <div class="summary-card card-opening">
      <div class="card-icon">üìã</div>
      <div class="card-content">
        <span class="card-label">T·ªìn ƒë·∫ßu k·ª≥</span>
        <span class="card-value">{{ formatCurrency(summary.openingAmount) }}</span>
      </div>
    </div>
    <div class="summary-card card-receipt">
      <div class="card-icon">üì•</div>
      <div class="card-content">
        <span class="card-label">Nh·∫≠p trong k·ª≥</span>
        <span class="card-value text-blue">+{{ formatCurrency(summary.receiptAmount) }}</span>
      </div>
    </div>
    <div class="summary-card card-issue">
      <div class="card-icon">üì§</div>
      <div class="card-content">
        <span class="card-label">Xu·∫•t trong k·ª≥</span>
        <span class="card-value text-red">-{{ formatCurrency(summary.issueAmount) }}</span>
      </div>
    </div>
    <div class="summary-card card-closing">
      <div class="card-icon">‚úÖ</div>
      <div class="card-content">
        <span class="card-label">T·ªìn cu·ªëi k·ª≥</span>
        <span class="card-value text-green">{{ formatCurrency(summary.closingAmount) }}</span>
      </div>
    </div>
  </div>

  <!-- FILTER SECTION -->
  <div class="filter-section">
    <div class="filter-row">
      <div class="filter-group filter-search">
        <label>T√¨m ki·∫øm</label>
        <input type="text" [(ngModel)]="searchText" (input)="onSearch()"
               placeholder="M√£ h√†ng, t√™n h√†ng...">
      </div>
      <div class="filter-group">
        <label>Lo·∫°i h√†ng</label>
        <select [(ngModel)]="filterProductType" (change)="onFilterChange()">
          <option value="">T·∫•t c·∫£</option>
          <option *ngFor="let type of productTypes" [value]="type.value">{{ type.label }}</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Nh√≥m h√†ng</label>
        <select [(ngModel)]="filterProductGroup" (change)="onFilterChange()">
          <option value="">T·∫•t c·∫£</option>
          <option *ngFor="let group of productGroups" [value]="group.value">{{ group.label }}</option>
        </select>
      </div>
      <div class="filter-group">
        <label>T·ª´ ng√†y</label>
        <input type="date" [ngModel]="fromDate | date:'yyyy-MM-dd'"
               (ngModelChange)="onFromDateChange($event)">
      </div>
      <div class="filter-group">
        <label>ƒê·∫øn ng√†y</label>
        <input type="date" [ngModel]="toDate | date:'yyyy-MM-dd'"
               (ngModelChange)="onToDateChange($event)">
      </div>
    </div>
    <div class="filter-row">
      <div class="date-shortcuts">
        <button class="btn-chip" (click)="setDateRange('thisMonth')">Th√°ng n√†y</button>
        <button class="btn-chip" (click)="setDateRange('lastMonth')">Th√°ng tr∆∞·ªõc</button>
        <button class="btn-chip" (click)="setDateRange('thisQuarter')">Qu√Ω n√†y</button>
        <button class="btn-chip" (click)="setDateRange('thisYear')">NƒÉm nay</button>
      </div>
      <button class="btn btn-secondary btn-sm" (click)="clearFilters()">X√≥a l·ªçc</button>
    </div>
  </div>

  <!-- REPORT TABLE -->
  <div class="table-container">
    <div class="report-title">
      <h2>B√ÅO C√ÅO T·ªîNG H·ª¢P NH·∫¨P - XU·∫§T - T·ªíN</h2>
      <p>K·ª≥: {{ formatDate(fromDate) }} - {{ formatDate(toDate) }}</p>
    </div>

    <table class="data-table">
      <thead>
        <tr>
          <th rowspan="2" class="col-no">STT</th>
          <th rowspan="2" class="col-code">M√£ h√†ng</th>
          <th rowspan="2" class="col-name">T√™n h√†ng h√≥a</th>
          <th rowspan="2" class="col-unit">ƒêVT</th>
          <th colspan="2" class="group-header opening">T·ªìn ƒë·∫ßu k·ª≥</th>
          <th colspan="2" class="group-header receipt">Nh·∫≠p trong k·ª≥</th>
          <th colspan="2" class="group-header issue">Xu·∫•t trong k·ª≥</th>
          <th colspan="2" class="group-header closing">T·ªìn cu·ªëi k·ª≥</th>
        </tr>
        <tr>
          <th class="col-qty text-right sub-header">SL</th>
          <th class="col-amount text-right sub-header">Th√†nh ti·ªÅn</th>
          <th class="col-qty text-right sub-header">SL</th>
          <th class="col-amount text-right sub-header">Th√†nh ti·ªÅn</th>
          <th class="col-qty text-right sub-header">SL</th>
          <th class="col-amount text-right sub-header">Th√†nh ti·ªÅn</th>
          <th class="col-qty text-right sub-header">SL</th>
          <th class="col-amount text-right sub-header">Th√†nh ti·ªÅn</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let line of filteredLines; let i = index">
          <td>{{ i + 1 }}</td>
          <td><span class="product-code">{{ line.productCode }}</span></td>
          <td>{{ line.productName }}</td>
          <td>{{ line.unit }}</td>
          <td class="text-right">{{ formatCurrency(line.openingQty) }}</td>
          <td class="text-right">{{ formatCurrency(line.openingAmount) }}</td>
          <td class="text-right text-blue">{{ formatCurrency(line.receiptQty) }}</td>
          <td class="text-right text-blue">{{ formatCurrency(line.receiptAmount) }}</td>
          <td class="text-right text-red">{{ formatCurrency(line.issueQty) }}</td>
          <td class="text-right text-red">{{ formatCurrency(line.issueAmount) }}</td>
          <td class="text-right text-green">{{ formatCurrency(line.closingQty) }}</td>
          <td class="text-right text-green">{{ formatCurrency(line.closingAmount) }}</td>
        </tr>
      </tbody>
      <tfoot>
        <tr class="total-row">
          <td colspan="4"><strong>T·ªîNG C·ªòNG</strong></td>
          <td class="text-right"></td>
          <td class="text-right"><strong>{{ formatCurrency(summary.openingAmount) }}</strong></td>
          <td class="text-right"></td>
          <td class="text-right text-blue"><strong>{{ formatCurrency(summary.receiptAmount) }}</strong></td>
          <td class="text-right"></td>
          <td class="text-right text-red"><strong>{{ formatCurrency(summary.issueAmount) }}</strong></td>
          <td class="text-right"></td>
          <td class="text-right text-green"><strong>{{ formatCurrency(summary.closingAmount) }}</strong></td>
        </tr>
      </tfoot>
    </table>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="filteredLines.length === 0 && !isLoading">
      <div class="empty-icon">üìä</div>
      <p>Kh√¥ng c√≥ d·ªØ li·ªáu</p>
    </div>
  </div>

  <!-- Loading -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="spinner"></div>
  </div>
</div>
