<div class="cash-book-page">
  <!-- HEADER -->
  <div class="page-header">
    <div>
      <h1 class="page-title">S·ªï Qu·ªπ Ti·ªÅn M·∫∑t</h1>
      <p class="page-subtitle">Theo d√µi thu chi ti·ªÅn m·∫∑t - TK 111</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="print()"><span class="icon">üñ®</span> In</button>
      <button class="btn btn-primary" (click)="exportToExcel()"><span class="icon">üì•</span> Xu·∫•t Excel</button>
    </div>
  </div>

  <!-- SUMMARY CARDS -->
  <div class="summary-cards">
    <div class="summary-card card-transactions"><div class="card-icon">üìù</div><div class="card-content"><span class="card-label">Giao d·ªãch</span><span class="card-value">{{ summary.transactionCount }}</span></div></div>
    <div class="summary-card card-opening"><div class="card-icon">üìã</div><div class="card-content"><span class="card-label">T·ªìn ƒë·∫ßu k·ª≥</span><span class="card-value">{{ formatCurrency(summary.openingBalance) }}</span></div></div>
    <div class="summary-card card-receipt"><div class="card-icon">üìà</div><div class="card-content"><span class="card-label">T·ªïng thu</span><span class="card-value text-green">{{ formatCurrency(summary.totalReceipt) }}</span></div></div>
    <div class="summary-card card-payment"><div class="card-icon">üìâ</div><div class="card-content"><span class="card-label">T·ªïng chi</span><span class="card-value text-red">{{ formatCurrency(summary.totalPayment) }}</span></div></div>
    <div class="summary-card card-closing"><div class="card-icon">üí∞</div><div class="card-content"><span class="card-label">T·ªìn cu·ªëi k·ª≥</span><span class="card-value text-blue">{{ formatCurrency(summary.closingBalance) }}</span></div></div>
  </div>

  <!-- FILTER SECTION -->
  <div class="filter-section">
    <div class="filter-row">
      <div class="filter-group">
        <label>Lo·∫°i phi·∫øu</label>
        <select [(ngModel)]="filterType" (change)="onTypeFilterChange()">
          <option value="">-- T·∫•t c·∫£ --</option>
          <option value="RECEIPT">Phi·∫øu thu</option>
          <option value="PAYMENT">Phi·∫øu chi</option>
        </select>
      </div>
      <div class="filter-group"><label>T·ª´ ng√†y</label><input type="date" [ngModel]="fromDate | date:'yyyy-MM-dd'" (ngModelChange)="onFromDateChange($event)"></div>
      <div class="filter-group"><label>ƒê·∫øn ng√†y</label><input type="date" [ngModel]="toDate | date:'yyyy-MM-dd'" (ngModelChange)="onToDateChange($event)"></div>
      <div class="filter-group">
        <div class="date-shortcuts">
          <button class="btn-chip" (click)="setDateRange('today')">H√¥m nay</button>
          <button class="btn-chip" (click)="setDateRange('thisWeek')">Tu·∫ßn n√†y</button>
          <button class="btn-chip" (click)="setDateRange('thisMonth')">Th√°ng n√†y</button>
          <button class="btn-chip" (click)="setDateRange('lastMonth')">Th√°ng tr∆∞·ªõc</button>
        </div>
      </div>
    </div>
  </div>

  <!-- CASH BOOK TABLE -->
  <div class="table-container">
    <div class="report-title">
      <h2>S·ªî QU·ª∏ TI·ªÄN M·∫∂T</h2>
      <p>K·ª≥: {{ formatDate(fromDate) }} - {{ formatDate(toDate) }}</p>
    </div>
    <table class="data-table">
      <thead>
        <tr>
          <th class="col-date">Ng√†y</th>
          <th class="col-voucher">S·ªë ch·ª©ng t·ª´</th>
          <th class="col-type">Lo·∫°i</th>
          <th class="col-desc">Di·ªÖn gi·∫£i</th>
          <th class="col-amount text-right">Thu</th>
          <th class="col-amount text-right">Chi</th>
          <th class="col-amount text-right">T·ªìn qu·ªπ</th>
        </tr>
      </thead>
      <tbody>
        <!-- Opening Balance Row -->
        <tr class="opening-row">
          <td>{{ formatDate(fromDate) }}</td>
          <td></td>
          <td></td>
          <td><strong>S·ªë d∆∞ ƒë·∫ßu k·ª≥</strong></td>
          <td class="text-right"></td>
          <td class="text-right"></td>
          <td class="text-right"><strong>{{ formatCurrency(summary.openingBalance) }}</strong></td>
        </tr>

        <!-- Transaction Rows -->
        <tr *ngFor="let line of cashBookLines" [class.receipt-row]="line.voucherType === 'RECEIPT'" [class.payment-row]="line.voucherType === 'PAYMENT'">
          <td>{{ formatDate(line.date) }}</td>
          <td><span class="voucher-no" [class.voucher-receipt]="line.voucherType === 'RECEIPT'" [class.voucher-payment]="line.voucherType === 'PAYMENT'">{{ line.voucherNo }}</span></td>
          <td><span class="type-badge" [class.type-receipt]="line.voucherType === 'RECEIPT'" [class.type-payment]="line.voucherType === 'PAYMENT'">{{ getTypeLabel(line.voucherType) }}</span></td>
          <td>{{ line.description }}</td>
          <td class="text-right text-green" *ngIf="line.receiptAmount">{{ formatCurrency(line.receiptAmount) }}</td>
          <td class="text-right" *ngIf="!line.receiptAmount"></td>
          <td class="text-right text-red" *ngIf="line.paymentAmount">{{ formatCurrency(line.paymentAmount) }}</td>
          <td class="text-right" *ngIf="!line.paymentAmount"></td>
          <td class="text-right" [ngClass]="getBalanceClass(line.balance)"><strong>{{ formatCurrency(line.balance) }}</strong></td>
        </tr>

        <!-- Summary Rows -->
        <tr class="subtotal-row">
          <td colspan="4"><strong>C·ªông ph√°t sinh</strong></td>
          <td class="text-right text-green"><strong>{{ formatCurrency(summary.totalReceipt) }}</strong></td>
          <td class="text-right text-red"><strong>{{ formatCurrency(summary.totalPayment) }}</strong></td>
          <td class="text-right"></td>
        </tr>
        <tr class="closing-row">
          <td>{{ formatDate(toDate) }}</td>
          <td colspan="3"><strong>S·ªë d∆∞ cu·ªëi k·ª≥</strong></td>
          <td class="text-right"></td>
          <td class="text-right"></td>
          <td class="text-right text-blue"><strong>{{ formatCurrency(summary.closingBalance) }}</strong></td>
        </tr>
      </tbody>
    </table>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="cashBookLines.length === 0 && !isLoading">
      <div class="empty-icon">üìã</div>
      <p>Kh√¥ng c√≥ giao d·ªãch trong k·ª≥ n√†y</p>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="isLoading"><div class="spinner"></div></div>
</div>
