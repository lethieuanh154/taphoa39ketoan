<div class="bank-page">
  <!-- HEADER -->
  <div class="page-header">
    <div>
      <h1 class="page-title">Danh M·ª•c Ng√¢n H√†ng</h1>
      <p class="page-subtitle">Qu·∫£n l√Ω t√†i kho·∫£n ng√¢n h√†ng c·ªßa doanh nghi·ªáp - TK 112</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="openCreateModal()">
        <span class="icon">‚ûï</span> Th√™m t√†i kho·∫£n
      </button>
    </div>
  </div>

  <!-- SUMMARY CARDS -->
  <div class="summary-cards">
    <div class="summary-card card-total">
      <div class="card-icon">üè¶</div>
      <div class="card-content">
        <span class="card-label">T·ªïng TK</span>
        <span class="card-value">{{ stats.totalAccounts }}</span>
      </div>
    </div>
    <div class="summary-card card-active">
      <div class="card-icon">‚úÖ</div>
      <div class="card-content">
        <span class="card-label">ƒêang ho·∫°t ƒë·ªông</span>
        <span class="card-value text-green">{{ stats.activeAccounts }}</span>
      </div>
    </div>
    <div class="summary-card card-balance">
      <div class="card-icon">üí∞</div>
      <div class="card-content">
        <span class="card-label">T·ªïng s·ªë d∆∞ (VNƒê)</span>
        <span class="card-value text-blue">{{ formatCurrency(stats.totalBalance) }}</span>
      </div>
    </div>
    <div class="summary-card card-banks" *ngFor="let bank of stats.byBank.slice(0, 2)">
      <div class="card-icon">üèõÔ∏è</div>
      <div class="card-content">
        <span class="card-label">{{ bank.bankName }}</span>
        <span class="card-value">{{ formatCurrency(bank.balance) }}</span>
      </div>
    </div>
  </div>

  <!-- FILTER SECTION -->
  <div class="filter-section">
    <div class="filter-row">
      <div class="filter-group filter-search">
        <label>T√¨m ki·∫øm</label>
        <input type="text" [(ngModel)]="searchText" (input)="onSearch()"
               placeholder="S·ªë TK, t√™n TK, ng√¢n h√†ng...">
      </div>
      <div class="filter-group">
        <label>Ng√¢n h√†ng</label>
        <select [(ngModel)]="filter.bankId" (change)="onFilterChange()">
          <option [ngValue]="undefined">T·∫•t c·∫£</option>
          <option *ngFor="let bank of banks" [value]="bank.id">{{ bank.shortName }}</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Lo·∫°i TK</label>
        <select [(ngModel)]="filter.accountType" (change)="onFilterChange()">
          <option [ngValue]="undefined">T·∫•t c·∫£</option>
          <option *ngFor="let t of accountTypes" [value]="t.value">{{ t.label }}</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Ti·ªÅn t·ªá</label>
        <select [(ngModel)]="filter.currency" (change)="onFilterChange()">
          <option [ngValue]="undefined">T·∫•t c·∫£</option>
          <option *ngFor="let c of currencies" [value]="c.value">{{ c.label }}</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Tr·∫°ng th√°i</label>
        <select [(ngModel)]="filter.status" (change)="onFilterChange()">
          <option [ngValue]="undefined">T·∫•t c·∫£</option>
          <option *ngFor="let s of accountStatuses" [value]="s.value">{{ s.label }}</option>
        </select>
      </div>
      <button class="btn btn-secondary btn-sm" (click)="clearFilters()">X√≥a l·ªçc</button>
    </div>
  </div>

  <!-- BANK ACCOUNTS TABLE -->
  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th class="col-no">STT</th>
          <th class="col-bank">Ng√¢n h√†ng</th>
          <th class="col-account">S·ªë t√†i kho·∫£n</th>
          <th class="col-name">T√™n ch·ªß TK</th>
          <th class="col-type">Lo·∫°i TK</th>
          <th class="col-currency">Ti·ªÅn t·ªá</th>
          <th class="col-balance text-right">S·ªë d∆∞ hi·ªán t·∫°i</th>
          <th class="col-status">Tr·∫°ng th√°i</th>
          <th class="col-actions">Thao t√°c</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let acc of filteredAccounts; let i = index" [class.default-row]="acc.isDefault">
          <td>{{ i + 1 }}</td>
          <td>
            <div class="bank-info">
              <span class="bank-name">{{ acc.bankName }}</span>
              <span class="bank-branch">{{ acc.branch }}</span>
            </div>
          </td>
          <td>
            <span class="account-no">{{ formatAccountNo(acc.accountNo) }}</span>
            <span class="default-badge" *ngIf="acc.isDefault">M·∫∑c ƒë·ªãnh</span>
          </td>
          <td>{{ acc.accountName }}</td>
          <td>{{ getAccountTypeLabel(acc.accountType) }}</td>
          <td><span class="currency-badge">{{ acc.currency }}</span></td>
          <td class="text-right">
            <span class="balance" [class.balance-usd]="acc.currency !== 'VND'">
              {{ formatCurrency(acc.currentBalance, acc.currency) }}
            </span>
          </td>
          <td>
            <span class="status-badge" [ngClass]="getStatusClass(acc.status)">
              {{ getStatusLabel(acc.status) }}
            </span>
          </td>
          <td>
            <div class="action-buttons">
              <button class="btn-icon btn-view" title="Xem" (click)="openViewModal(acc)">üëÅ</button>
              <button class="btn-icon btn-edit" title="S·ª≠a" (click)="openEditModal(acc)">‚úèÔ∏è</button>
              <button class="btn-icon btn-default" title="ƒê·∫∑t m·∫∑c ƒë·ªãnh" *ngIf="!acc.isDefault && acc.status === 'ACTIVE'" (click)="setAsDefault(acc)">‚≠ê</button>
              <button class="btn-icon btn-delete" title="X√≥a" (click)="deleteAccount(acc)">üóëÔ∏è</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="filteredAccounts.length === 0 && !isLoading">
      <div class="empty-icon">üè¶</div>
      <p>Ch∆∞a c√≥ t√†i kho·∫£n ng√¢n h√†ng n√†o</p>
      <button class="btn btn-primary" (click)="openCreateModal()">Th√™m t√†i kho·∫£n ƒë·∫ßu ti√™n</button>
    </div>
  </div>

  <!-- MODAL -->
  <div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>
          {{ modalMode === 'create' ? 'Th√™m t√†i kho·∫£n ng√¢n h√†ng' :
             modalMode === 'edit' ? 'Ch·ªânh s·ª≠a t√†i kho·∫£n' : 'Th√¥ng tin t√†i kho·∫£n' }}
        </h2>
        <button class="btn-close" (click)="closeModal()">‚úï</button>
      </div>

      <div class="modal-body">
        <!-- Validation Errors -->
        <div class="validation-errors" *ngIf="validationErrors.length > 0">
          <p *ngFor="let err of validationErrors">‚ö†Ô∏è {{ err }}</p>
        </div>

        <div class="form-section">
          <h4>Th√¥ng tin ng√¢n h√†ng</h4>
          <div class="form-row">
            <div class="form-group">
              <label>Ng√¢n h√†ng <span class="required">*</span></label>
              <select [(ngModel)]="editingAccount.bankId" (change)="onBankChange()" [disabled]="modalMode === 'view'">
                <option [ngValue]="undefined">-- Ch·ªçn ng√¢n h√†ng --</option>
                <option *ngFor="let bank of banks" [value]="bank.id">{{ bank.shortName }} - {{ bank.name }}</option>
              </select>
            </div>
            <div class="form-group">
              <label>Chi nh√°nh</label>
              <input type="text" [(ngModel)]="editingAccount.branch" [disabled]="modalMode === 'view'"
                     placeholder="Chi nh√°nh H√† N·ªôi">
            </div>
          </div>
        </div>

        <div class="form-section">
          <h4>Th√¥ng tin t√†i kho·∫£n</h4>
          <div class="form-row">
            <div class="form-group">
              <label>S·ªë t√†i kho·∫£n <span class="required">*</span></label>
              <input type="text" [(ngModel)]="editingAccount.accountNo" [disabled]="modalMode === 'view'"
                     placeholder="0011234567890">
            </div>
            <div class="form-group">
              <label>T√™n ch·ªß t√†i kho·∫£n <span class="required">*</span></label>
              <input type="text" [(ngModel)]="editingAccount.accountName" [disabled]="modalMode === 'view'"
                     placeholder="CONG TY TNHH ABC">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Lo·∫°i t√†i kho·∫£n</label>
              <select [(ngModel)]="editingAccount.accountType" [disabled]="modalMode === 'view'">
                <option *ngFor="let t of accountTypes" [value]="t.value">{{ t.label }}</option>
              </select>
            </div>
            <div class="form-group">
              <label>Lo·∫°i ti·ªÅn t·ªá</label>
              <select [(ngModel)]="editingAccount.currency" (change)="onCurrencyChange()" [disabled]="modalMode === 'view'">
                <option *ngFor="let c of currencies" [value]="c.value">{{ c.label }}</option>
              </select>
            </div>
            <div class="form-group">
              <label>Tr·∫°ng th√°i</label>
              <select [(ngModel)]="editingAccount.status" [disabled]="modalMode === 'view'">
                <option *ngFor="let s of accountStatuses" [value]="s.value">{{ s.label }}</option>
              </select>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h4>S·ªë d∆∞ & K·∫ø to√°n</h4>
          <div class="form-row">
            <div class="form-group">
              <label>S·ªë d∆∞ ƒë·∫ßu k·ª≥</label>
              <input type="number" [(ngModel)]="editingAccount.openingBalance" [disabled]="modalMode === 'view'">
            </div>
            <div class="form-group">
              <label>S·ªë d∆∞ hi·ªán t·∫°i</label>
              <input type="number" [(ngModel)]="editingAccount.currentBalance" [disabled]="modalMode === 'view' || modalMode === 'edit'">
            </div>
            <div class="form-group">
              <label>T√†i kho·∫£n k·∫ø to√°n <span class="required">*</span></label>
              <select [(ngModel)]="editingAccount.glAccount" [disabled]="modalMode === 'view'">
                <option *ngFor="let gl of glAccounts" [value]="gl.code">{{ gl.code }} - {{ gl.name }}</option>
              </select>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h4>Th√¥ng tin b·ªï sung</h4>
          <div class="form-row">
            <div class="form-group">
              <label>Ng∆∞·ªùi li√™n h·ªá t·∫°i NH</label>
              <input type="text" [(ngModel)]="editingAccount.contactPerson" [disabled]="modalMode === 'view'">
            </div>
            <div class="form-group">
              <label>S·ªë ƒëi·ªán tho·∫°i</label>
              <input type="text" [(ngModel)]="editingAccount.contactPhone" [disabled]="modalMode === 'view'">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Username Internet Banking</label>
              <input type="text" [(ngModel)]="editingAccount.ibUsername" [disabled]="modalMode === 'view'">
            </div>
            <div class="form-group checkbox-group">
              <label>
                <input type="checkbox" [(ngModel)]="editingAccount.isDefault" [disabled]="modalMode === 'view'">
                ƒê·∫∑t l√†m t√†i kho·∫£n m·∫∑c ƒë·ªãnh
              </label>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group full-width">
              <label>Ghi ch√∫</label>
              <textarea [(ngModel)]="editingAccount.notes" [disabled]="modalMode === 'view'" rows="3"></textarea>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer" *ngIf="modalMode !== 'view'">
        <button class="btn btn-secondary" (click)="closeModal()">H·ªßy</button>
        <button class="btn btn-primary" (click)="saveAccount()">
          {{ modalMode === 'create' ? 'Th√™m m·ªõi' : 'C·∫≠p nh·∫≠t' }}
        </button>
      </div>
      <div class="modal-footer" *ngIf="modalMode === 'view'">
        <button class="btn btn-secondary" (click)="closeModal()">ƒê√≥ng</button>
        <button class="btn btn-primary" (click)="modalMode = 'edit'">Ch·ªânh s·ª≠a</button>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="spinner"></div>
  </div>
</div>
