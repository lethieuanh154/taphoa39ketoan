<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SUPPLIER PAGE - DANH M·ª§C NH√Ä CUNG C·∫§P
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<div class="supplier-page">

  <!-- HEADER -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">Danh m·ª•c nh√† cung c·∫•p</h1>
      <p class="page-subtitle">Qu·∫£n l√Ω th√¥ng tin NCC - C√¥ng n·ª£ ph·∫£i tr·∫£ (TK 331)</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="openCreateModal()">
        <span class="icon">+</span>
        Th√™m NCC
      </button>
    </div>
  </div>

  <!-- STATS CARDS -->
  <div class="stats-cards">
    <div class="stat-card card-total">
      <div class="stat-icon">üè≠</div>
      <div class="stat-content">
        <span class="stat-label">T·ªïng s·ªë</span>
        <span class="stat-value">{{ stats.total }}</span>
      </div>
    </div>
    <div class="stat-card card-active">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-content">
        <span class="stat-label">ƒêang ho·∫°t ƒë·ªông</span>
        <span class="stat-value">{{ stats.active }}</span>
      </div>
    </div>
    <div class="stat-card card-inactive">
      <div class="stat-icon">‚è∏Ô∏è</div>
      <div class="stat-content">
        <span class="stat-label">Ng·ª´ng ho·∫°t ƒë·ªông</span>
        <span class="stat-value">{{ stats.inactive }}</span>
      </div>
    </div>
    <div class="stat-card card-goods">
      <div class="stat-icon">üì¶</div>
      <div class="stat-content">
        <span class="stat-label">H√†ng h√≥a</span>
        <span class="stat-value">{{ stats.byGroup['GOODS'] || 0 }}</span>
      </div>
    </div>
    <div class="stat-card card-service">
      <div class="stat-icon">üîß</div>
      <div class="stat-content">
        <span class="stat-label">D·ªãch v·ª•</span>
        <span class="stat-value">{{ stats.byGroup['SERVICE'] || 0 }}</span>
      </div>
    </div>
  </div>

  <!-- FILTERS -->
  <div class="filter-section">
    <div class="filter-row">
      <div class="filter-group filter-search">
        <label>T√¨m ki·∫øm</label>
        <input type="text" [(ngModel)]="filter.search" (input)="onFilterChange()" placeholder="M√£ NCC, t√™n, MST, SƒêT...">
      </div>
      <div class="filter-group">
        <label>Lo·∫°i NCC</label>
        <select [(ngModel)]="filter.supplierType" (change)="onFilterChange()">
          <option [ngValue]="undefined">T·∫•t c·∫£</option>
          <option *ngFor="let type of supplierTypes" [value]="type.value">{{ type.label }}</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Nh√≥m NCC</label>
        <select [(ngModel)]="filter.supplierGroup" (change)="onFilterChange()">
          <option [ngValue]="undefined">T·∫•t c·∫£</option>
          <option *ngFor="let group of supplierGroups" [value]="group.value">{{ group.label }}</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Tr·∫°ng th√°i</label>
        <select [ngModel]="filter.status || ''" (ngModelChange)="onStatusFilterChange($event)">
          <option value="">T·∫•t c·∫£</option>
          <option value="ACTIVE">ƒêang ho·∫°t ƒë·ªông</option>
          <option value="INACTIVE">Ng·ª´ng ho·∫°t ƒë·ªông</option>
        </select>
      </div>
    </div>
  </div>

  <!-- TABLE -->
  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th class="col-no">STT</th>
          <th class="col-code">M√£ NCC</th>
          <th class="col-name">T√™n nh√† cung c·∫•p</th>
          <th class="col-tax">MST</th>
          <th class="col-type">Lo·∫°i</th>
          <th class="col-group">Nh√≥m</th>
          <th class="col-phone">ƒêi·ªán tho·∫°i</th>
          <th class="col-term">H·∫°n TT</th>
          <th class="col-status">Tr·∫°ng th√°i</th>
          <th class="col-actions">Thao t√°c</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let supplier of filteredSuppliers; let i = index" [class.inactive]="supplier.status === 'INACTIVE'">
          <td class="col-no">{{ i + 1 }}</td>
          <td class="col-code"><span class="supplier-code">{{ supplier.code }}</span></td>
          <td class="col-name">
            <div class="supplier-info">
              <span class="supplier-name">{{ supplier.name }}</span>
              <span class="supplier-short" *ngIf="supplier.shortName">({{ supplier.shortName }})</span>
            </div>
          </td>
          <td class="col-tax">{{ supplier.taxCode || '-' }}</td>
          <td class="col-type">{{ getSupplierTypeLabel(supplier.supplierType) }}</td>
          <td class="col-group">
            <span class="group-badge" [class]="'group-' + supplier.supplierGroup.toLowerCase()">
              {{ getSupplierGroupLabel(supplier.supplierGroup) }}
            </span>
          </td>
          <td class="col-phone">{{ supplier.phone || '-' }}</td>
          <td class="col-term">{{ supplier.paymentTermDays }} ng√†y</td>
          <td class="col-status">
            <span class="status-badge" [class]="getStatusClass(supplier.status)">{{ getStatusLabel(supplier.status) }}</span>
          </td>
          <td class="col-actions">
            <div class="action-buttons">
              <button class="btn-icon btn-view" title="Xem" (click)="viewDetail(supplier)">üëÅÔ∏è</button>
              <button class="btn-icon btn-edit" title="S·ª≠a" (click)="openEditModal(supplier)">‚úèÔ∏è</button>
              <button class="btn-icon btn-delete" title="X√≥a" (click)="confirmDelete(supplier)">üóëÔ∏è</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="empty-state" *ngIf="filteredSuppliers.length === 0">
      <div class="empty-icon">üè≠</div>
      <p>Kh√¥ng c√≥ nh√† cung c·∫•p n√†o</p>
    </div>
  </div>
</div>

<!-- CREATE/EDIT MODAL -->
<div class="modal-overlay" *ngIf="showCreateModal" (click)="closeCreateModal()">
  <div class="modal modal-large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ isEditMode ? 'S·ª≠a nh√† cung c·∫•p' : 'Th√™m nh√† cung c·∫•p m·ªõi' }}</h2>
      <button class="btn-close" (click)="closeCreateModal()">&times;</button>
    </div>
    <div class="modal-body">
      <!-- Basic Info -->
      <div class="form-section">
        <h3 class="section-title">Th√¥ng tin c∆° b·∫£n</h3>
        <div class="form-grid">
          <div class="form-group">
            <label>M√£ NCC <span class="required">*</span></label>
            <input type="text" [(ngModel)]="formData.code" [disabled]="isEditMode">
          </div>
          <div class="form-group col-span-2">
            <label>T√™n nh√† cung c·∫•p <span class="required">*</span></label>
            <input type="text" [(ngModel)]="formData.name" placeholder="Nh·∫≠p t√™n NCC">
          </div>
          <div class="form-group">
            <label>T√™n vi·∫øt t·∫Øt</label>
            <input type="text" [(ngModel)]="formData.shortName">
          </div>
          <div class="form-group">
            <label>Lo·∫°i NCC</label>
            <select [(ngModel)]="formData.supplierType">
              <option *ngFor="let type of supplierTypes" [value]="type.value">{{ type.label }}</option>
            </select>
          </div>
          <div class="form-group">
            <label>Nh√≥m NCC</label>
            <select [(ngModel)]="formData.supplierGroup">
              <option *ngFor="let group of supplierGroups" [value]="group.value">{{ group.label }}</option>
            </select>
          </div>
          <div class="form-group">
            <label>Tr·∫°ng th√°i</label>
            <select [(ngModel)]="formData.status">
              <option *ngFor="let s of supplierStatus" [value]="s.value">{{ s.label }}</option>
            </select>
          </div>
          <div class="form-group">
            <label>M√£ s·ªë thu·∫ø</label>
            <input type="text" [(ngModel)]="formData.taxCode" placeholder="0123456789">
          </div>
        </div>
      </div>

      <!-- Address -->
      <div class="form-section">
        <h3 class="section-title">ƒê·ªãa ch·ªâ</h3>
        <div class="form-grid">
          <div class="form-group col-span-3">
            <label>ƒê·ªãa ch·ªâ <span class="required">*</span></label>
            <input type="text" [(ngModel)]="formData.address" placeholder="S·ªë nh√†, ƒë∆∞·ªùng...">
          </div>
          <div class="form-group">
            <label>Ph∆∞·ªùng/X√£</label>
            <input type="text" [(ngModel)]="formData.ward">
          </div>
          <div class="form-group">
            <label>Qu·∫≠n/Huy·ªán</label>
            <input type="text" [(ngModel)]="formData.district">
          </div>
          <div class="form-group">
            <label>T·ªânh/Th√†nh ph·ªë</label>
            <input type="text" [(ngModel)]="formData.province">
          </div>
        </div>
      </div>

      <!-- Contact -->
      <div class="form-section">
        <h3 class="section-title">Li√™n h·ªá</h3>
        <div class="form-grid">
          <div class="form-group">
            <label>ƒêi·ªán tho·∫°i</label>
            <input type="text" [(ngModel)]="formData.phone">
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" [(ngModel)]="formData.email">
          </div>
          <div class="form-group">
            <label>Website</label>
            <input type="text" [(ngModel)]="formData.website">
          </div>
          <div class="form-group">
            <label>Fax</label>
            <input type="text" [(ngModel)]="formData.fax">
          </div>
        </div>
      </div>

      <!-- Payment Terms -->
      <div class="form-section">
        <h3 class="section-title">ƒêi·ªÅu kho·∫£n thanh to√°n</h3>
        <div class="form-grid">
          <div class="form-group">
            <label>S·ªë ng√†y ƒë∆∞·ª£c n·ª£</label>
            <input type="number" [(ngModel)]="formData.paymentTermDays" min="0">
          </div>
          <div class="form-group">
            <label>H·∫°n m·ª©c c√¥ng n·ª£</label>
            <input type="number" [(ngModel)]="formData.creditLimit" min="0">
          </div>
          <div class="form-group">
            <label>TK c√¥ng n·ª£</label>
            <input type="text" [(ngModel)]="formData.accountCode" value="331">
          </div>
        </div>
      </div>

      <!-- Contacts -->
      <div class="form-section">
        <div class="section-header">
          <h3 class="section-title">Ng∆∞·ªùi li√™n h·ªá</h3>
          <button class="btn btn-secondary btn-sm" (click)="addContact()">+ Th√™m</button>
        </div>
        <div class="contacts-list" *ngIf="formContacts.length > 0">
          <div class="contact-item" *ngFor="let contact of formContacts; let i = index">
            <input type="text" [(ngModel)]="contact.name" placeholder="H·ªç t√™n">
            <input type="text" [(ngModel)]="contact.position" placeholder="Ch·ª©c v·ª•">
            <input type="text" [(ngModel)]="contact.phone" placeholder="ƒêi·ªán tho·∫°i">
            <input type="email" [(ngModel)]="contact.email" placeholder="Email">
            <button class="btn-icon btn-remove" (click)="removeContact(i)">‚úï</button>
          </div>
        </div>
        <p class="empty-text" *ngIf="formContacts.length === 0">Ch∆∞a c√≥ ng∆∞·ªùi li√™n h·ªá</p>
      </div>

      <!-- Bank Accounts -->
      <div class="form-section">
        <div class="section-header">
          <h3 class="section-title">T√†i kho·∫£n ng√¢n h√†ng</h3>
          <button class="btn btn-secondary btn-sm" (click)="addBankAccount()">+ Th√™m</button>
        </div>
        <div class="bank-list" *ngIf="formBankAccounts.length > 0">
          <div class="bank-item" *ngFor="let bank of formBankAccounts; let i = index">
            <input type="text" [(ngModel)]="bank.bankName" placeholder="T√™n ng√¢n h√†ng">
            <input type="text" [(ngModel)]="bank.accountNumber" placeholder="S·ªë t√†i kho·∫£n">
            <input type="text" [(ngModel)]="bank.accountHolder" placeholder="Ch·ªß t√†i kho·∫£n">
            <input type="text" [(ngModel)]="bank.branch" placeholder="Chi nh√°nh">
            <button class="btn-icon btn-remove" (click)="removeBankAccount(i)">‚úï</button>
          </div>
        </div>
        <p class="empty-text" *ngIf="formBankAccounts.length === 0">Ch∆∞a c√≥ t√†i kho·∫£n ng√¢n h√†ng</p>
      </div>

      <!-- Note -->
      <div class="form-section">
        <div class="form-group">
          <label>Ghi ch√∫</label>
          <textarea [(ngModel)]="formData.note" rows="2"></textarea>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeCreateModal()">H·ªßy</button>
      <button class="btn btn-primary" (click)="saveSupplier()" [disabled]="loading">
        {{ loading ? 'ƒêang l∆∞u...' : (isEditMode ? 'C·∫≠p nh·∫≠t' : 'Th√™m m·ªõi') }}
      </button>
    </div>
  </div>
</div>

<!-- DETAIL MODAL -->
<div class="modal-overlay" *ngIf="showDetailModal && selectedSupplier" (click)="closeDetailModal()">
  <div class="modal modal-large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Chi ti·∫øt NCC: {{ selectedSupplier.code }}</h2>
      <button class="btn-close" (click)="closeDetailModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="detail-grid">
        <div class="detail-section">
          <h4>Th√¥ng tin c∆° b·∫£n</h4>
          <div class="detail-item"><label>M√£ NCC:</label><span>{{ selectedSupplier.code }}</span></div>
          <div class="detail-item"><label>T√™n:</label><span>{{ selectedSupplier.name }}</span></div>
          <div class="detail-item" *ngIf="selectedSupplier.shortName"><label>Vi·∫øt t·∫Øt:</label><span>{{ selectedSupplier.shortName }}</span></div>
          <div class="detail-item"><label>Lo·∫°i:</label><span>{{ getSupplierTypeLabel(selectedSupplier.supplierType) }}</span></div>
          <div class="detail-item"><label>Nh√≥m:</label><span>{{ getSupplierGroupLabel(selectedSupplier.supplierGroup) }}</span></div>
          <div class="detail-item" *ngIf="selectedSupplier.taxCode"><label>MST:</label><span>{{ selectedSupplier.taxCode }}</span></div>
          <div class="detail-item"><label>Tr·∫°ng th√°i:</label><span class="status-badge" [class]="getStatusClass(selectedSupplier.status)">{{ getStatusLabel(selectedSupplier.status) }}</span></div>
        </div>
        <div class="detail-section">
          <h4>ƒê·ªãa ch·ªâ & Li√™n h·ªá</h4>
          <div class="detail-item"><label>ƒê·ªãa ch·ªâ:</label><span>{{ formatFullAddress(selectedSupplier) }}</span></div>
          <div class="detail-item" *ngIf="selectedSupplier.phone"><label>ƒêi·ªán tho·∫°i:</label><span>{{ selectedSupplier.phone }}</span></div>
          <div class="detail-item" *ngIf="selectedSupplier.email"><label>Email:</label><span>{{ selectedSupplier.email }}</span></div>
          <div class="detail-item" *ngIf="selectedSupplier.website"><label>Website:</label><span>{{ selectedSupplier.website }}</span></div>
        </div>
        <div class="detail-section">
          <h4>ƒêi·ªÅu kho·∫£n thanh to√°n</h4>
          <div class="detail-item"><label>S·ªë ng√†y n·ª£:</label><span>{{ selectedSupplier.paymentTermDays }} ng√†y</span></div>
          <div class="detail-item"><label>H·∫°n m·ª©c CN:</label><span>{{ formatCurrency(selectedSupplier.creditLimit) }}</span></div>
          <div class="detail-item"><label>TK c√¥ng n·ª£:</label><span>{{ selectedSupplier.accountCode }}</span></div>
        </div>
      </div>
      <div class="detail-list" *ngIf="selectedSupplier.contacts && selectedSupplier.contacts.length > 0">
        <h4>Ng∆∞·ªùi li√™n h·ªá</h4>
        <table class="sub-table">
          <thead><tr><th>H·ªç t√™n</th><th>Ch·ª©c v·ª•</th><th>ƒêi·ªán tho·∫°i</th><th>Email</th></tr></thead>
          <tbody>
            <tr *ngFor="let c of selectedSupplier.contacts">
              <td>{{ c.name }}</td><td>{{ c.position || '-' }}</td><td>{{ c.phone || '-' }}</td><td>{{ c.email || '-' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="detail-list" *ngIf="selectedSupplier.bankAccounts && selectedSupplier.bankAccounts.length > 0">
        <h4>T√†i kho·∫£n ng√¢n h√†ng</h4>
        <table class="sub-table">
          <thead><tr><th>Ng√¢n h√†ng</th><th>S·ªë TK</th><th>Ch·ªß TK</th><th>Chi nh√°nh</th></tr></thead>
          <tbody>
            <tr *ngFor="let b of selectedSupplier.bankAccounts">
              <td>{{ b.bankName }}</td><td>{{ b.accountNumber }}</td><td>{{ b.accountHolder }}</td><td>{{ b.branch || '-' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="detail-note" *ngIf="selectedSupplier.note">
        <h4>Ghi ch√∫</h4>
        <p>{{ selectedSupplier.note }}</p>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeDetailModal()">ƒê√≥ng</button>
      <button class="btn btn-primary" (click)="openEditModal(selectedSupplier); closeDetailModal()">S·ª≠a</button>
    </div>
  </div>
</div>

<!-- DELETE CONFIRM -->
<div class="modal-overlay" *ngIf="showDeleteConfirm" (click)="showDeleteConfirm = false">
  <div class="modal modal-small" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>X√°c nh·∫≠n x√≥a</h2>
      <button class="btn-close" (click)="showDeleteConfirm = false">&times;</button>
    </div>
    <div class="modal-body">
      <div class="warning-message">
        <span class="warning-icon">‚ö†Ô∏è</span>
        <p>B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a NCC <strong>{{ selectedSupplier?.name }}</strong>?</p>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="showDeleteConfirm = false">H·ªßy</button>
      <button class="btn btn-danger" (click)="deleteSupplier()">X√≥a</button>
    </div>
  </div>
</div>

<div class="loading-overlay" *ngIf="loading"><div class="spinner"></div></div>
