<div class="user-roles-page">
  <!-- HEADER -->
  <div class="page-header">
    <div class="header-left">
      <h1>üë• Ph√¢n Quy·ªÅn Ng∆∞·ªùi D√πng</h1>
      <p class="subtitle">Qu·∫£n l√Ω ng∆∞·ªùi d√πng v√† ph√¢n quy·ªÅn truy c·∫≠p</p>
    </div>
  </div>

  <!-- TABS -->
  <div class="tabs">
    <button class="tab" [class.active]="activeTab === 'users'" (click)="activeTab = 'users'">
      üë§ Ng∆∞·ªùi d√πng ({{ users.length }})
    </button>
    <button class="tab" [class.active]="activeTab === 'roles'" (click)="activeTab = 'roles'">
      üîê Vai tr√≤ ({{ roles.length }})
    </button>
  </div>

  <!-- USERS TAB -->
  <div class="tab-content" *ngIf="activeTab === 'users'">
    <div class="content-header">
      <h2>Danh s√°ch ng∆∞·ªùi d√πng</h2>
      <button class="btn btn-primary" (click)="openUserModal()">+ Th√™m ng∆∞·ªùi d√πng</button>
    </div>

    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>Username</th>
            <th>H·ªç t√™n</th>
            <th>Email</th>
            <th>Vai tr√≤</th>
            <th>ƒêƒÉng nh·∫≠p l·∫ßn cu·ªëi</th>
            <th>Tr·∫°ng th√°i</th>
            <th>Thao t√°c</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of users">
            <td><strong>{{ user.username }}</strong></td>
            <td>{{ user.fullName }}</td>
            <td>{{ user.email }}</td>
            <td>
              <span class="role-badge">{{ user.role }}</span>
            </td>
            <td>{{ formatDate(user.lastLogin) }}</td>
            <td>
              <span class="status-badge" [ngClass]="getStatusClass(user.status)">
                {{ getStatusLabel(user.status) }}
              </span>
            </td>
            <td>
              <button class="btn-icon" title="S·ª≠a" (click)="openUserModal(user)">‚úèÔ∏è</button>
              <button class="btn-icon" title="ƒê·ªïi m·∫≠t kh·∫©u">üîë</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ROLES TAB -->
  <div class="tab-content" *ngIf="activeTab === 'roles'">
    <div class="content-header">
      <h2>Danh s√°ch vai tr√≤</h2>
      <button class="btn btn-primary" (click)="openRoleModal()">+ Th√™m vai tr√≤</button>
    </div>

    <div class="roles-grid">
      <div *ngFor="let role of roles" class="role-card" (click)="openRoleModal(role)">
        <div class="role-header">
          <h3>{{ role.name }}</h3>
          <span class="user-count">{{ role.userCount }} ng∆∞·ªùi d√πng</span>
        </div>
        <p class="role-description">{{ role.description }}</p>
        <div class="role-permissions">
          <span *ngFor="let perm of role.permissions.slice(0, 3)" class="permission-tag">
            {{ perm }}
          </span>
          <span *ngIf="role.permissions.length > 3" class="permission-more">
            +{{ role.permissions.length - 3 }}
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- USER MODAL -->
  <div class="modal-overlay" *ngIf="showUserModal" (click)="closeUserModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ editingUser.id ? 'S·ª≠a' : 'Th√™m' }} ng∆∞·ªùi d√πng</h2>
        <button class="btn-close" (click)="closeUserModal()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Username</label>
          <input type="text" [(ngModel)]="editingUser.username" [disabled]="!!editingUser.id">
        </div>
        <div class="form-group">
          <label>H·ªç t√™n</label>
          <input type="text" [(ngModel)]="editingUser.fullName">
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" [(ngModel)]="editingUser.email">
        </div>
        <div class="form-group">
          <label>Vai tr√≤</label>
          <select [(ngModel)]="editingUser.role">
            <option *ngFor="let role of roles" [value]="role.name">{{ role.name }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Tr·∫°ng th√°i</label>
          <select [(ngModel)]="editingUser.status">
            <option value="ACTIVE">Ho·∫°t ƒë·ªông</option>
            <option value="INACTIVE">Ng·ª´ng ho·∫°t ƒë·ªông</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeUserModal()">H·ªßy</button>
        <button class="btn btn-primary" (click)="saveUser()">L∆∞u</button>
      </div>
    </div>
  </div>

  <!-- ROLE MODAL -->
  <div class="modal-overlay" *ngIf="showRoleModal" (click)="closeRoleModal()">
    <div class="modal role-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ editingRole.id ? 'S·ª≠a' : 'Th√™m' }} vai tr√≤</h2>
        <button class="btn-close" (click)="closeRoleModal()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>T√™n vai tr√≤</label>
          <input type="text" [(ngModel)]="editingRole.name">
        </div>
        <div class="form-group">
          <label>M√¥ t·∫£</label>
          <textarea [(ngModel)]="editingRole.description" rows="2"></textarea>
        </div>
        <div class="permissions-section">
          <label>Ph√¢n quy·ªÅn</label>
          <div *ngFor="let group of permissionGroups" class="permission-group">
            <h4>{{ group.name }}</h4>
            <div class="permission-list">
              <label *ngFor="let perm of group.permissions" class="checkbox-label">
                <input type="checkbox">
                {{ perm }}
              </label>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeRoleModal()">H·ªßy</button>
        <button class="btn btn-primary" (click)="saveRole()">L∆∞u</button>
      </div>
    </div>
  </div>
</div>
